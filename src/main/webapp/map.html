<!DOCTYPE html>
<html>
<head>
  <title>Maps</title>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/map.css">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCgr6Zutm1Os7q9V5Fi9N_g2poKcDG2G0A">
    </script>

    <script>
      var map;
      var markers = [];
      var count = 0;

      //uses window.setTimeout() to drop markers consecutively
      function addMarkerWithTimeout(position, timeout) {
        window.setTimeout(function() {
          markers.push(new google.maps.Marker({
            position: position,
            map: map,
            animation: google.maps.Animation.DROP
          }));
        }, timeout);
      }

      //initializes the map with specified center and zoom
      function createCountriesMap(){
        fetch('/Countries').then(function(response) {
          return response.json();
        }).then((CountryMaps) => {
            var prev_infowindow = null;

            map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: 16.4774, lng: -24.97},
            zoom: 3
          });
          CountryMaps.forEach((CountryMap) => {
             var countryUrl = '/country/' + CountryMap.code;
             const marker = new google.maps.Marker({
              position: {lat: CountryMap.lat, lng: CountryMap.lng},
              map: map
            });
             marker.addListener('click', function() {
              content: CountryMap.name
              window.location.href = countryUrl;
              //prevents multiple infowindows from being open at the same time
              if (prev_infowindow) {
                prev_infowindow.close();
              }
              prev_infowindow = infoWindow;
              infoWindow.open(map, marker);
             });

             var infoWindow = new google.maps.InfoWindow({
              content: CountryMap.name
             });
          });
        });
      }

    </script>
</head>

<body onload="createCountriesMap();">
 <h1>Countries</h1>
 <h3>Click on a country to start chatting!!</h3>
 <div id="map"></div>
</body>
</html>
